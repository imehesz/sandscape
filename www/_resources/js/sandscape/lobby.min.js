var globals={lastReceived:0,urls:{upd:"",send:""},filter:{ALL:0,PAUSED:1,RUNNING:2,IPLAY:3,WAITINGME:4,WAITINGOPPONENT:5}};function initLobby(){$("#writemessage").keypress(function(a){if(a.which==13){$("#sendbtn").click()}});setTimeout(updateMessages,5000);$(".join").click(function(a){$("#game").val($(this).children(".hGameId").val());$("#maxDecksJoin").val($(this).children(".hGameDM").val());$("#joindlg").modal()});$(".spectate").click(function(a){$("#specgame").val($(this).children(".hGameId").val());$("#spectatedlg").modal()});$(".return").click(function(a){window.location=$(this).children(".hGameUrl").val()})}function sendMessage(){var a=$("#writemessage").val();if(a.length>0){$.ajax({type:"POST",url:globals.urls.send,data:{chatmessage:a},dataType:"json",success:function(b){if(b.success){$("#messages-list").append("<li><strong>"+b.name+":</strong>&nbsp;"+a+"</li>");globals.lastReceived=b.id;chatToBottom()}}});$("#writemessage").val("")}}function updateMessages(){$.ajax({type:"POST",url:globals.urls.upd,data:{lastupdate:globals.lastReceived},dataType:"json",success:function(a){if(a.has){$.each(a.messages,function(){$("#lobbychat").append("<li><span><strong>"+this.name+"</strong>&nbsp;["+this.date+"]:</span><br />"+this.message+"</li>")});globals.lastReceived=a.last;chatToBottom()}},complete:function(){setTimeout(updateMessages,5000)}})}function limitDeckSelection(c){var a=parseInt($("#maxDecks").val(),10),d=$(".marker").filter(":checked").length,b=$(c);if(b.is(":disabled")){if(d==a){b.removeAttr("disabled")}}else{if(d!=a){b.attr("disabled","disabled")}}}function usersSliderScroll(f,d){var b=$("#users-view"),c=$("#users-list"),a=c.height()-b.height();if(a>0){$("#users-list").css({top:-(a*(100-d.value)/100)})}}function usersSliderChange(f,d){var b=$("#users-view"),c=$("#users-list"),a=c.height()-b.height();if(a>0){$("#users-list").css({top:-(a*(100-d.value)/100)})}}function chatSliderScroll(b,a){$("#messages-list").css({top:a.value})}function chatSliderChange(b,a){$("#messages-list").css({top:a.value})}function chatSliderSetValue(b,a){chatChatToBottom()}function chatChatToBottom(){var a=$("#chat-slider"),e=$("#messages-list"),b=e.height(),d=$("#chat-view").height(),c=-(b-d);console.log("bh: "+b+", vh: "+d+", h: "+c);if(b>d){a.slider("option","min",c).slider("option","value",c);e.animate({top:c},"slow")}}function gamesSliderScroll(f,d){var b=$("#games-view"),c=$("#games-list"),a=c.height()-b.height();if(a>0){$("#games-list").css({top:-(a*(100-d.value)/100)})}}function gamesSliderChange(f,d){var b=$("#games-view"),c=$("#games-list"),a=c.height()-b.height();if(a>0){$("#games-list").css({top:-(a*(100-d.value)/100)})}}function filterGameList(){switch(parseInt($("#filterGames").val(),10)){case globals.filter.ALL:$(".paused").show();$(".running").show();$(".my-game").show();$(".wait-me").show();$(".wait-opponent").show();break;case globals.filter.PAUSED:$(".running").hide();$(".my-game").hide();$(".wait-me").hide();$(".wait-opponent").hide();$(".paused").show();break;case globals.filter.RUNNING:$(".paused").hide();$(".my-game").hide();$(".wait-me").hide();$(".wait-opponent").hide();$(".running").show();break;case globals.filter.IPLAY:$(".paused").hide();$(".running").hide();$(".wait-me").hide();$(".wait-opponent").hide();$(".my-game").show();break;case globals.filter.WAITINGME:$(".paused").hide();$(".running").hide();$(".my-game").hide();$(".wait-opponent").hide();$(".wait-me").show();break;case globals.filter.WAITINGOPPONENT:$(".paused").hide();$(".running").hide();$(".my-game").hide();$(".wait-me").hide();$(".wait-opponent").show();break}$("#games-list").css({top:0});$("#games-slider").slider("option","value",100)};