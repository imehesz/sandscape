var globals={imageUrl:""};function init(a){globals.imageUrl=a;var c=$("#available-cards"),b=$("#selected-cards");$("#filterSelected").keyup(function(f){var d=$(this);if(d.val().length){filter(b.find("li"),d.val())}else{b.find("li:hidden").show()}});$("#filterAvailable").keyup(function(f){var d=$(this);if(d.val().length){filter(c.find("li"),d.val())}else{c.find("li:hidden").show()}});b.droppable({accept:".available",drop:dropCard}).find("li").draggable({appendTo:"body",revert:"invalid",helper:inDeckDragHelper}).dblclick(removeSelectedCard).click(function(d){loadPreviewImage(parseInt($(this).attr("id").substr(1),10))}).find("img").click(removeSeveral);c.droppable({accept:".in-deck",drop:dropRemoveCard}).find("li").draggable({appendTo:"body",revert:"invalid",helper:function(){return $(document.createElement("div")).append($(document.createElement("img")).attr("src","_resources/images/icon-x16-small-plus.png")).append($(this).text())}}).dblclick(selectCard).click(function(d){loadPreviewImage(parseInt($(this).attr("id").substr(1),10))});$('#hiddenIds input[name="selected\\[\\]"]').each(function(){$(this).data("for","s"+$(this).val())})}function loadPreviewImage(a){$.ajax({url:globals.imageUrl,data:{card:a},type:"POST",dataType:"json",success:function(b){if(b.success){$("#previewImage").attr("src","_game/cards/"+b.image)}else{$("#previewImage").attr("src","_game/cards/cardback.png")}}})}function dropCard(c,d){var b=$(this),a="s"+d.draggable.attr("id").substr(1);addCard(b,d.draggable,b.find("#"+a),$("#card-total"))}function selectCard(d){var c=$("#selected-cards"),b=$(this),a="s"+b.attr("id").substr(1);addCard(c,b,c.find("#"+a),$("#card-total"))}function addCard(c,b,g,f){var e=1,d,a=b.attr("id").substr(1);if(g.length){d=g.find(".card-count");d.html(parseInt(d.html(),10)+1)}else{$(document.createElement("li")).attr("id","s"+a).addClass("in-deck").draggable({appendTo:"body",revert:"invalid",helper:inDeckDragHelper}).append($(document.createElement("img")).attr("src","_resources/images/icon-x16-small-cross.png").click(removeSeveral)).append(b.text()).append($(document.createElement("span")).addClass("card-count").html(e)).dblclick(removeSelectedCard).click(function(h){loadPreviewImage(parseInt($(this).attr("id").substr(1),10))}).appendTo(c)}$(document.createElement("input")).attr({type:"hidden",name:"selected[]",id:"h"+a+"-"+e,value:a}).data("for","s"+a).appendTo($("#hiddenIds"));f.html(parseInt(f.html(),10)+1)}function removeSelectedCard(c){var d=$(this),a=d.attr("id"),i=null,b=$('#hiddenIds input[name="selected\\[\\]"]'),j=0,h=null,g,f=$("#card-total");b.each(function(){h=$(this);if(h.data("for")==a){if(j==0){i=h}j++}});if(i){g=d.find(".card-count");g.text(parseInt(g.text(),10)-1);f.text(parseInt(f.text(),10)-1);i.remove();if(j==1){d.remove()}}}function filter(a,b){b=$.trim(b).replace(/ /gi,"|");a.each(function(){($(this).text().search(new RegExp(b,"i"))<0)?$(this).hide():$(this).show()})}function removeSeveral(a){removeNCards($(this).parent("li"));return false}function dropRemoveCard(a,b){removeNCards(b.draggable)}function removeNCards(e){var h=e.attr("id"),d=1,f=Array(),a,b,c=$("#card-total"),g=0;$('#hiddenIds input[name="selected\\[\\]"]').each(function(){if($(this).data("for")==h){f.push($(this))}});if(f.length>1){d=parseInt(prompt("How many cards to remove?",f.length),10)}if(!isNaN(d)){for(a=0;a<d;a++){f[a].remove()}b=e.find(".card-count");g=parseInt(b.text(),10);if(g-d==0){e.remove()}else{b.text(g-d)}c.text(parseInt(c.text(),10)-d)}}function inDeckDragHelper(){return $(document.createElement("div")).append($(document.createElement("img")).attr("src","_resources/images/icon-x16-small-minus.png")).append($(this).find(".card-name").text())};