
(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var settings={options:[],radius:100,speed:'fast',arc:2*Math.PI,angleOffset:Math.PI/2}
$.extend(settings,options);settings.visible=false;settings.allElems=new Array();settings.base=$this;$this.data('radialmenu',settings).addClass('radialmenu').bind('click.radialmenu',methods.toggle).data('radialmenu_subelements',new Array()).data('radialmenu_parent',null)
methods.createOptions($this,settings.options);})},createOptions:function(parent,options){for(var i=0;i<options.length;++i){options[i].elem=$(document.createElement('div')).html(options[i].option).data('parent',parent).data('radialmenu',parent.data('radialmenu')).data('optionConfig',options[i]).data('protected',false).addClass('radialmenuOption').css(parent.offset()).css({position:'absolute',opacity:0}).hide().bind('click.radialmenu',function(){if(!$(this).is(':animated')){if($(this).data('optionConfig').event)$(this).data('optionConfig').event($(this).data('radialmenu').base);if($(this).data('optionConfig').subMenu){var subelements=$(this).data('radialmenu_subelements');$(this).data('protected',true);for(var i=0;i<subelements.length;++i){if(subelements[i].is(':visible')){$(this).radialmenu('showNode',$(this).data('radialmenu_parent'));return;}}
$(this).radialmenu('showNode',$(this));}
else $(this).radialmenu('hideAll');}}).appendTo('body');parent.data('radialmenu').allElems.push(options[i].elem);parent.data('radialmenu_subelements').push(options[i].elem);options[i].elem.data('radialmenu_parent',parent);options[i].elem.data('radialmenu_subelements',new Array());if(options[i].subMenu){methods.createOptions(options[i].elem,options[i].subMenu);}}},toggle:function(){return $(this).each(function(){var $this=$(this);if(!$this.data('radialmenu').visible)$this.radialmenu('show');else $this.radialmenu('hideAll');});},show:function(){return this.each(function(){var $this=$(this);$this.radialmenu('showNode',$this);})},showNode:function(node){return this.each(function(){var $this=$(this);var data=$this.data('radialmenu');var center;var elements=node.data('radialmenu_subelements');if(node.data('radialmenu_position')){node.css(node.data('radialmenu_position'));center=node.data('radialmenu_position');}else{center={top:node.offset().top+Math.round(.5*node.height()),left:node.offset().left+Math.round(.5*node.width())}}
node.data('protected',true);$(elements).each(function(i,o){$(o).data('protected',true)})
$this.radialmenu('hideAll');node.css('opacity',1).show();if(node.hasClass('radialmenu'))node.data('radialmenu').visible=true;$(elements).each(function(i,o){var angle=data.arc/elements.length*i+data.angleOffset;$(o).show();var position={top:Math.round(node.offset().top+.5*node.height())-Math.round(data.radius*Math.sin(angle))-Math.round(.5*$(o).height()),left:Math.round(node.offset().left+.5*node.width())+Math.round(data.radius*Math.cos(angle))-Math.round(.5*$(o).width())}
if($(o).position().top!=position.top||$(o).position().left!=position.left){$(o).css(center)
$(o).css({opacity:0})}
$(o).data('radialmenu_origin',center).data('radialmenu_position',position).animate({top:position.top,left:position.left,opacity:1},{duration:data.speed})})
$('.radialmenuOption').each(function(i,o){$(o).data('protected',false)})})},hideAll:function(){$('.radialmenu').each(function(i,o){$(this).data('radialmenu').visible=false;})
$('.radialmenuOption').each(function(i,o){if(!$(o).data('protected')){if($(o).data('radialmenu_origin')){$(o).animate({top:$(o).data('radialmenu_origin').top,left:$(o).data('radialmenu_origin').left,opacity:0},{duration:$(o).data('radialmenu').speed,complete:function(){$(this).data('radialmenu_origin',null).hide()}})}else $(o).hide()}})
$('.radialmenuOption').each(function(i,o){$(o).data('protected',false)})
return this;},destroy:function(){this.unbind('.radialmenu');return this.each(function(i,o){var elems=$(o).data('radialmenu').allElems;$(o).removeClass('radialmenu');for(var i=0;i<elems.length;++i)elems[i].remove();})}};$.fn.radialmenu=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.tooltip');}}})(jQuery);$(window).bind('keypress.radialmenu',function(event){if(event.keyCode==27){$('.radialmenu:first').radialmenu('hideAll');}});